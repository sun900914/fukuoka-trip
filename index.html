<!doctype html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>福岡 7 天之旅</title>

  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/201/201623.png">
  <meta name="theme-color" content="#b91c1c">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      /* Japanese Minimalist Palette */
      --primary-color: #b91c1c;
      /* Deep Red (Japan Red) */
      --bg-color: #fcfaf7;
      /* Off-white (Rice Paper) */
      --text-color: #2d3436;
      /* Charcoal */
      --accent-color: #d63031;
      --card-bg: #ffffff;
      --nav-active-bg: #b91c1c;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: "Noto Sans TC", "Helvetica Neue", Helvetica, Arial, sans-serif;
      overflow-x: hidden;
    }

    /* Hero Section */
    .hero-header {
      position: relative;
      /* Gradient Background (Guaranteed to show) */
      background: linear-gradient(135deg, #e52d27 0%, #b31217 100%);
      background-size: cover;
      background-position: center;
      color: #fff;
      padding: 6rem 1rem 4rem;
      margin-bottom: 0;
      text-align: center;
    }

    .hero-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.2);
      /* Slight darken */
      z-index: 1;
    }

    .hero-content {
      position: relative;
      z-index: 2;
    }

    .hero-title {
      font-weight: 700;
      text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      letter-spacing: 2px;
    }

    /* Cards */
    .card {
      border: none;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
      /* Soft, modern shadow */
      margin-bottom: 1.5rem;
      background-color: var(--card-bg);
      overflow: hidden;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    /* Tabs Navigation */
    .nav-pills-wrapper {
      overflow-x: auto;
      white-space: nowrap;
      padding-bottom: 5px;
      /* space for scrollbar if needed */
      scrollbar-width: none;
      /* hide scrollbar for cleaner look */
    }

    .nav-pills-wrapper::-webkit-scrollbar {
      display: none;
    }

    .nav-pills .nav-link {
      color: #636e72;
      background-color: #e9ecef;
      margin-right: 0.5rem;
      border-radius: 50rem;
      /* Pill shape */
      padding: 0.5rem 1.2rem;
      font-weight: 500;
      transition: all 0.3s;
    }

    .nav-pills .nav-link.active {
      background-color: var(--nav-active-bg);
      color: #fff;
      box-shadow: 0 4px 10px rgba(185, 28, 28, 0.4);
    }

    /* Timeline */
    .timeline {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .timeline-item {
      position: relative;
      padding-left: 3.5rem;
      padding-bottom: 2rem;
      border-left: 2px solid #dfe6e9;
      /* Lighter border */
      margin-left: 0.5rem;
    }

    /* Mobile Adjustments */
    @media (max-width: 768px) {
      .timeline-item {
        padding-left: 2rem;
        /* reduced from 2.5rem */
        margin-left: 0;
      }

      .timeline-icon {
        width: 28px;
        height: 28px;
        font-size: 0.8rem;
        left: -14px;
        /* Center 28px icon on border */
        top: 2px;
      }
    }

    .timeline-item:last-child {
      border-left: 2px solid transparent;
    }

    .timeline-icon {
      position: absolute;
      left: -20px;
      /* Center 40px icon on border */
      top: 0;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #fff;
      border: 2px solid #dfe6e9;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent-color);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      /* Soft shadow */
      z-index: 10;
    }

    .timeline-icon.food-icon {
      background-color: var(--primary-color);
      color: white;
      border-color: #fff;
      /* White border for contrast */
    }

    .timeline-content {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: 12px;
      margin-top: -0.25rem;
    }

    /* Weather Widget Styling */
    .weather-card {
      background: linear-gradient(120deg, #89f7fe 0%, #66a6ff 100%);
      color: white;
    }

    /* Back to Top */
    #back-to-top {
      position: fixed;
      bottom: 25px;
      right: 25px;
      display: none;
      z-index: 1000;
      border-radius: 50%;
      width: 55px;
      height: 55px;
      font-size: 1.2rem;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      border: none;
      background-color: var(--primary-color);
      color: white;
      transition: transform 0.3s;
    }

    #back-to-top:hover {
      transform: scale(1.1);
    }

    /* Utility */
    .text-justify {
      text-align: justify;
    }
  </style>
</head>

<body>

  <!-- Back to Top Button -->
  <button id="back-to-top" onclick="scrollToTop()">
    <i class="fa-solid fa-arrow-up"></i>
  </button>

  <header class="hero-header">
    <div class="hero-overlay"></div>
    <div class="container hero-content">
      <h1 class="display-3 hero-title" id="main-title">Loading...</h1>
      <p class="lead fw-normal mb-3" id="sub-title">...</p>
      <div class="d-inline-flex align-items-center bg-white text-dark px-4 py-2 rounded-pill shadow-sm">
        <i class="fa-regular fa-calendar-alt me-2 text-danger"></i>
        <span id="date-range" class="fw-bold">...</span>
      </div>
    </div>
  </header>

  <main class="container py-4" style="margin-top: -30px; position: relative; z-index: 10;">

    <!-- Weather Widget (Mockup link) -->
    <div class="row mb-4">
      <div class="col-12">
        <a href="https://weather.yahoo.co.jp/weather/jp/40/8210.html" target="_blank" class="text-decoration-none">
          <div
            class="card weather-card text-white py-3 px-4 d-flex flex-row align-items-center justify-content-between">
            <div class="d-flex align-items-center">
              <i class="fa-solid fa-cloud-sun fa-2x me-3"></i>
              <div>
                <h5 class="mb-0 fw-bold">福岡天氣預報</h5>
                <small>點擊查看 Yahoo! JP 即時氣象</small>
              </div>
            </div>
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </a>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="row mb-4 sticky-top bg-transparent pt-2" style="top: 0px; z-index: 900;">
      <div class="col-12">
        <div class="card shadow-sm p-1 rounded-pill d-block"
          style="background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);">
          <div class="nav-pills-wrapper">
            <ul class="nav nav-pills d-flex flex-nowrap" id="pills-tab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pills-info-tab" data-bs-toggle="pill" data-bs-target="#pills-info"
                  type="button" role="tab" style="white-space: nowrap;">
                  <i class="fa-solid fa-circle-info me-1"></i> 資訊
                </button>
              </li>
              <!-- JS will populate Days here -->
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content -->
    <div class="tab-content" id="pills-tabContent">

      <!-- Info Tab (Flights & Hotel) -->
      <div class="tab-pane fade show active" id="pills-info" role="tabpanel">

        <!-- Flight Info -->
        <section id="flights" class="mb-4">
          <h4 class="fw-bold mb-3 border-start border-4 border-danger ps-3">航班資訊</h4>
          <div class="row g-3" id="flight-list">
            <!-- JS rendered -->
          </div>
        </section>

        <!-- Accommodation -->
        <section id="accommodation" class="mb-4">
          <h4 class="fw-bold mb-3 border-start border-4 border-danger ps-3">住宿資訊</h4>
          <div id="hotel-info">
            <!-- JS rendered -->
          </div>
        </section>

      </div>

      <!-- Days Content will be injected here by JS -->

    </div>

    <!-- Important Data Modal -->
    <div class="modal fade" id="infoModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">詳細資訊</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" id="modal-body-content">...</div>
        </div>
      </div>
    </div>

  </main>

  <footer class="text-center py-5 text-secondary border-top">
    <p class="mb-1 fw-bold">福岡 7 天之旅</p>
    <small>© 2026 Enjoy your trip!</small>
  </footer>

  <!-- Load Data -->
  <script src="trip_data.js"></script>

  <!-- Main Logic -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // 1. Render Header
      document.getElementById("main-title").textContent = tripData.title;
      document.title = tripData.title;
      document.getElementById("sub-title").textContent = tripData.subtitle;
      document.getElementById("date-range").textContent = `${tripData.meta.startDate} ~ ${tripData.meta.endDate}`;

      // 2. Render Flights
      const flightContainer = document.getElementById("flight-list");
      tripData.flights.forEach(flight => {
        const col = document.createElement("div");
        col.className = "col-md-6";
        col.innerHTML = `
        <div class="card h-100 flight-card p-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="badge ${flight.type === 'Arrival' ? 'bg-primary' : 'bg-success'} rounded-pill px-3">${flight.type === 'Arrival' ? '去程' : '回程'}</span>
            <small class="text-secondary fw-bold">${flight.date}</small>
          </div>
          <h5 class="fw-bold mb-2">${flight.airline} ${flight.flightNo}</h5>
          <div class="d-flex justify-content-between align-items-center my-4">
            <div class="text-center">
              <div class="display-6 fw-bold text-dark">${flight.departure.time}</div>
              <small class="text-muted text-uppercase">${flight.departure.city}</small>
            </div>
            <div class="text-muted"><i class="fa-solid fa-plane fa-lg"></i></div>
            <div class="text-center">
              <div class="display-6 fw-bold text-dark">${flight.arrival.time}</div>
              <small class="text-muted text-uppercase">${flight.arrival.city}</small>
            </div>
          </div>
          <div class="bg-light rounded p-3 small text-secondary">
            <i class="fa-solid fa-circle-info text-info me-1"></i> ${flight.note}
          </div>
        </div>
      `;
        flightContainer.appendChild(col);
      });

      // 3. Render Accommodation
      if (tripData.meta.hotel) {
        const hotel = tripData.meta.hotel;
        const hotelDiv = document.getElementById("hotel-info");
        const mapEmbedUrl = `https://www.google.com/maps?q=${encodeURIComponent(hotel.name + " " + hotel.address)}&output=embed`;

        hotelDiv.innerHTML = `
        <div class="card border-0 shadow-sm overflow-hidden">
          <div class="row g-0">
            <div class="col-md-7 p-4 d-flex flex-column justify-content-center">
              <h4 class="fw-bold mb-3">${hotel.name}</h4>
              <div class="d-flex align-items-start mb-3">
                <i class="fa-solid fa-location-dot text-danger mt-1 me-2"></i>
                <div>
                    <span id="hotel-address" class="d-block mb-1">${hotel.address}</span>
                    <button class="btn btn-sm btn-link text-decoration-none p-0" onclick="copyAddress()">複製地址</button>
                </div>
              </div>
              <div class="mt-2">
                  <a href="${hotel.mapUrl}" target="_blank" class="btn btn-outline-danger rounded-pill px-4">
                    <i class="fa-solid fa-map-location-dot me-1"></i> Google Maps
                  </a>
              </div>
            </div>
            <div class="col-md-5 bg-light" style="min-height: 250px;">
               <iframe 
                 width="100%" 
                 height="100%" 
                 style="border:0;" 
                 loading="lazy" 
                 allowfullscreen 
                 src="${mapEmbedUrl}">
               </iframe>
            </div>
          </div>
        </div>
      `;
      }

      // 4. Render Days (Tabs & Content)
      const navList = document.getElementById("pills-tab");
      const tabContentContainer = document.getElementById("pills-tabContent");

      tripData.days.forEach((day, index) => {
        // A. Add Tab Button
        const tabItem = document.createElement("li");
        tabItem.className = "nav-item";
        tabItem.role = "presentation";
        tabItem.innerHTML = `
            <button class="nav-link" id="pills-day${day.day}-tab" data-bs-toggle="pill" data-bs-target="#pills-day${day.day}" type="button" role="tab" style="white-space: nowrap;">
                Day ${day.day}
            </button>`;
        navList.appendChild(tabItem);

        // B. Render Tab Content
        const tabPane = document.createElement("div");
        tabPane.className = "tab-pane fade";
        tabPane.id = `pills-day${day.day}`;
        tabPane.role = "tabpanel";

        // Filter Items
        const diningItems = day.schedule.filter(item =>
          item.title.includes("早餐") || item.title.includes("午餐") || item.title.includes("晚餐")
        );
        const scheduleItems = day.schedule.filter(item =>
          !item.title.includes("早餐") && !item.title.includes("午餐") && !item.title.includes("晚餐")
        );

        // 1. Dining HTML (Separate Cards)
        const diningHtml = diningItems.map(item => {
          // Extract URL from desc
          const msgMatch = item.desc.match(/href=['"](.*?)['"]/);
          const mapUrl = msgMatch ? msgMatch[1] : null;
          // Clean Desc
          const cleanDesc = item.desc.replace(/<a.*?>.*?<\/a>/, '').trim().replace(/[\(\)]/g, '').trim();

          return `
            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm dining-card">
                    <div class="card-body p-3">
                        <div class="d-flex align-items-center mb-3">
                            <div class="rounded-circle bg-danger bg-opacity-10 text-danger p-3 me-3 d-flex align-items-center justify-content-center" style="width:50px; height:50px; flex-shrink:0;">
                                <i class="fa-solid fa-${item.icon || 'utensils'}"></i>
                            </div>
                            <div>
                                <h6 class="fw-bold mb-1 text-dark">${item.title}</h6>
                                <div class="small text-muted">${cleanDesc}</div>
                            </div>
                        </div>
                        ${mapUrl ? `
                        <a href="${mapUrl}" target="_blank" class="btn btn-outline-danger btn-sm rounded-pill w-100">
                            <i class="fa-solid fa-map-location-dot me-1"></i> Google Maps
                        </a>` : ''}
                    </div>
                </div>
            </div>
        `}).join('');

        // 2. Timeline HTML (Schedule Only)
        const timelineHtml = scheduleItems.map(item => `
        <li class="timeline-item">
          <div class="timeline-icon bg-white">
            <i class="fa-solid fa-${item.icon || 'circle'}"></i>
          </div>
          <div class="timeline-content shadow-sm">
             <h6 class="fw-bold mb-1">${item.title}</h6>
             <div class="text-secondary small mb-0">${item.desc}</div>
          </div>
        </li>
      `).join('');

        // Highlights
        const highlightsHtml = day.highlights.map(h =>
          `<span class="badge rounded-pill bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25 me-1 mb-1 px-3 py-2">${h}</span>`
        ).join('');

        tabPane.innerHTML = `
            <div class="card mb-3 border-0">
                <div class="card-body p-3 p-md-4 bg-transparent">
                    <!-- Date Header -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3 class="fw-bold m-0 text-dark">Day ${day.day}</h3>
                        <span class="badge bg-dark rounded-pill">${day.date}</span>
                    </div>
                    <h5 class="text-danger mb-4"><i class="fa-solid fa-map-pin me-2"></i>${day.location}</h5>
                    
                    <div class="mb-4">
                        ${highlightsHtml}
                    </div>

                    <!-- Dining Section Separate -->
                    ${diningItems.length > 0 ? `
                    <div class="mb-4">
                        <h6 class="fw-bold text-secondary mb-3"><i class="fa-solid fa-utensils me-2"></i>美食推薦</h6>
                        <div class="row g-2">
                            ${diningHtml}
                        </div>
                    </div>
                    ` : ''}

                    <hr class="my-4 text-secondary opacity-25">

                    <!-- Transport -->
                    <div class="p-3 bg-white shadow-sm rounded-3 mb-4 d-flex align-items-center border">
                         <i class="fa-solid fa-train text-secondary fa-lg me-3"></i>
                         <div>
                            <small class="text-uppercase text-muted fw-bold" style="font-size: 0.7rem;">TRANSPORT</small>
                            <div class="fw-bold">${day.transport}</div>
                         </div>
                    </div>

                    <!-- Main Timeline -->
                    <h6 class="fw-bold text-secondary mb-3"><i class="fa-solid fa-clock me-2"></i>行程安排</h6>
                    <ul class="timeline">
                        ${timelineHtml}
                    </ul>
                </div>
            </div>
        `;
        tabContentContainer.appendChild(tabPane);
      });
    });

    function copyAddress() {
      const address = document.getElementById("hotel-address").innerText;
      navigator.clipboard.writeText(address).then(() => {
        alert("地址已複製！");
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    }

    // Back to Top logic
    const backToTopBtn = document.getElementById("back-to-top");
    window.onscroll = function () {
      if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
        backToTopBtn.style.display = "block";
      } else {
        backToTopBtn.style.display = "none";
      }
    };
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // FORCE UNREGISTER SERVICE WORKER TO CLEAR CACHE
    // (We disable PWA temporarily to ensure you see the new design)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function (registrations) {
        for (let registration of registrations) {
          console.log('Unregistering SW to force update:', registration);
          registration.unregister();
        }
      });
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>